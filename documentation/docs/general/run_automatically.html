

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating custom simulations with Python API &mdash; Benchmark for Diagnosis, Reconfiguration &amp; Planning 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating custom simulations with OMEdit" href="run_manually.html" />
    <link rel="prev" title="Running simulations" href="quickrun.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Benchmark for Diagnosis, Reconfiguration & Planning
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Topics:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="berfipl_intro.html">BeRfiPl - Benchmark for Diagnosis, Reconfiguration &amp; Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_steps.html">First steps</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="quickrun.html">Running simulations</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating custom simulations with Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_manually.html">Creating custom simulations with OMEdit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulation_models/simulation_models_overview.html">Simulation models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulation_models/simulation_superModels_overview.html">Simulation superModels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_scripts/python_scripts_overview.html">Python API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Benchmark for Diagnosis, Reconfiguration & Planning</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="quickrun.html">Running simulations</a> &raquo;</li>
        
      <li>Creating custom simulations with Python API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/general/run_automatically.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="creating-custom-simulations-with-python-api">
<h1>Creating custom simulations with Python API<a class="headerlink" href="#creating-custom-simulations-with-python-api" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Depending on your hardware, and simulation setup, creating datasets with BeRfiPl simulation models may take some time.</p>
</div>
<p>When using the Python API a structural manipulation of the CPS modules is not possible.
Mainly the composition of the Cyber-Physical Process Plant and its high level parametrization is manipulable.
You can adapt the existing simulation setups or introduce your own setups in three steps:</p>
<section id="step-1">
<h2>Step 1:<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h2>
<p>To manipulate the Cyber-Physical Process Plant setup the <code class="docutils literal notranslate"><span class="pre">benchmark_config.json</span></code> must be changed.
It is important to fill out all points in the config file, otherwise the simulation can be corrupted.
Below is a sample simulation setup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> <span class="p">{</span>
<span class="linenos"> 2</span> <span class="s2">&quot;ds1&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 3</span>   <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 4</span>      <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mixer_partial0&quot;</span><span class="p">,</span> <span class="s2">&quot;source0&quot;</span><span class="p">,</span> <span class="s2">&quot;source1&quot;</span><span class="p">,</span> <span class="s2">&quot;source2&quot;</span><span class="p">,</span> <span class="s2">&quot;sink0&quot;</span><span class="p">],</span>
<span class="linenos"> 5</span>      <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;source0&quot;</span><span class="p">,</span> <span class="s2">&quot;mixer_partial0&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;source1&quot;</span><span class="p">,</span> <span class="s2">&quot;mixer_partial0&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;source2&quot;</span><span class="p">,</span> <span class="s2">&quot;mixer_partial0&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;mixer_partial0&quot;</span><span class="p">,</span> <span class="s2">&quot;sink0&quot;</span><span class="p">]]</span>
<span class="linenos"> 6</span>        <span class="p">},</span>
<span class="linenos"> 7</span> <span class="s2">&quot;faults&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;lc&quot;</span><span class="p">],</span>
<span class="linenos"> 8</span> <span class="s2">&quot;faulty_module&quot;</span><span class="p">:[</span><span class="s2">&quot;mixer_partial0&quot;</span><span class="p">],</span>
<span class="linenos"> 9</span> <span class="s2">&quot;ProdIn&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">],</span>
<span class="linenos">10</span> <span class="s2">&quot;ProdOut&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;redyellowblue&quot;</span><span class="p">]</span>
<span class="linenos">11</span>  <span class="p">}</span>
<span class="linenos">12</span> <span class="p">}</span>
</pre></div>
</div>
<dl>
<dt>The config file contains a dictionary, which includes:</dt><dd><blockquote>
<div><ul>
<li><dl class="simple">
<dt>The dataset name</dt><dd><p>In this case <code class="docutils literal notranslate"><span class="pre">ds1</span></code>. The name can be customized.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>The configuration</dt><dd><p>The configuration of the Cyber-Physical Process Plants is noted in the form of a directed graph under <code class="docutils literal notranslate"><span class="pre">model</span></code>.
Under <code class="docutils literal notranslate"><span class="pre">nodes</span></code> all employed modules in the custom setup have to be listed as strings.
Under <code class="docutils literal notranslate"><span class="pre">edges</span></code> the directed connections between the employed modules have to be listed as tuples in list form.</p>
<p><strong>Important: Every input and output of a module must be connected. If there is no preceding or succeeding module, place a source or sink, respectively.</strong></p>
<p><strong>Important: The modules have to be indexed! Modules without an index will cause errors in the compilation of the simulation.</strong></p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<ul>
<li><dl>
<dt>The Faults</dt><dd><p>Under <code class="docutils literal notranslate"><span class="pre">faults</span></code> one of three employable faults can be added to the simulation.
Each element in the list will create a new dataset, which will contain the employed fault.
If <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> is added to the list, a fault-free dataset will be generated.
The fault cases are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> : no faults.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;l&quot;</span></code> : a leakage will be induced. The leakage will purge some of the volume flow into a sink outside the system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;c&quot;</span></code> : a clogging will be induced. The clogging will reduce the diameter of a pipe within a module and lead to an increase in pressure.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;lc&quot;</span></code> : a leakage and a clogging will be induced. The named effects will be included superposed within the dataset.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>The faulty module</dt><dd><p>Under <code class="docutils literal notranslate"><span class="pre">faulty_module</span></code> the faulty module can be selected. The name must match a module name (with index!) from the <code class="docutils literal notranslate"><span class="pre">model:nodes</span></code> list.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Input products &amp; output products</dt><dd><p>Under <code class="docutils literal notranslate"><span class="pre">ProdIn</span></code> and <code class="docutils literal notranslate"><span class="pre">ProdOut</span></code> a list of the input products and output products of the Cyber-Physical Process Plant is given.
The names of the products can be customized. We suggest colors <code class="docutils literal notranslate"><span class="pre">red</span></code>, <code class="docutils literal notranslate"><span class="pre">yellow</span></code>, and <code class="docutils literal notranslate"><span class="pre">blue</span></code>.
Additionally, adjectives, like <code class="docutils literal notranslate"><span class="pre">*_bottled</span></code>, <code class="docutils literal notranslate"><span class="pre">*_distilled</span></code>, or proportions like <code class="docutils literal notranslate"><span class="pre">*_0.8</span></code> can be added.
Optionally, product descriptions in any variety can be added. This feature mainly focuses on the planning aspect of the dataset.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<p>Once you adapted the config file, save it under <code class="docutils literal notranslate"><span class="pre">benchmark_config.json</span></code> in JSON format.</p>
</section>
<section id="step-2">
<h2>Step 2:<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h2>
<p>After adapting your Cyber-Physical Process Plant setup you can customize your simulation setup and its hyper-parameters.
Therefore you can change <code class="docutils literal notranslate"><span class="pre">call.mos</span></code> file. This file executes the modelica simulation.
Especially the last line of this file is of interest. The preceding lines are for importing all models.
In case you did not add any additional modules, they are not in your interest.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">simulate</span><span class="p">(</span><span class="n">process_plant</span><span class="p">,</span> <span class="n">startTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stopTime</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">numberOfIntervals</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">outputFormat</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">simflags</span><span class="o">=</span><span class="s2">&quot;-maxIntegrationOrder=1&quot;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="simple">
<dt>Within the last lines you can set the simulation hyperparameters like:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>startTime</dt><dd><p>Indicating the time from which the simulation is going to generate data.
(Standard value: 0)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>stopTime</dt><dd><p>Indicating the time the simulation will be stopped.
(Standard value: 4000)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>numberOfIntervalls</dt><dd><p>Indicating the number of intervals that will be simulated, or indirectly the sampling rate.
(Standard value: 40000)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>outputFormat</dt><dd><p>Format of output file
(standard value: “csv”)</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</section>
<section id="step-3">
<h2>Step 3:<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h2>
<p>Once you adapted your simulation hyper-parameters, you can now run the <code class="docutils literal notranslate"><span class="pre">create_benchmark.py</span></code> file in your terminal.
The datasets will be saved to the <code class="docutils literal notranslate"><span class="pre">./datasets</span></code> directory.
To run <code class="docutils literal notranslate"><span class="pre">create_benchmark.py</span></code> navigate to the repository in your terminal, activate your conda environment and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(berfiple) $ python create_benchmark.py
</pre></div>
</div>
<p>To understand on how the <code class="docutils literal notranslate"><span class="pre">create_benchmark.py</span></code> script is running the simulation, please visit its entry.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case the simulation does not work, you probably did something wrong in the preceding steps.
Review your steps rigorously and run the simulation again.</p>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="run_manually.html" class="btn btn-neutral float-right" title="Creating custom simulations with OMEdit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickrun.html" class="btn btn-neutral float-left" title="Running simulations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, IMB

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>